ROSLIB.RWTPlot=function(a){this.max_data=a.max_data||100,this.use_timestamp=a.timestamp,this.plot=null,this.drawingp=!1,this.clearData()},ROSLIB.RWTPlot.prototype.clearData=function(){this.data=this.use_timestamp?[]:new ROSLIB.RingBuffer({bufferCount:this.max_data}),this.need_to_animate=!1},ROSLIB.RWTPlot.prototype.initializePlot=function(a,b){var c=$(a).width(),d=$(a).height(),e={top:20,right:20,bottom:20,left:40},f=this,g=b.yaxis||{},h=g.min||0,i=g.max||1;this.x=d3.scale.linear().domain([0,this.max_data-1]).range([0,c-e.left-e.right]),this.y=d3.scale.linear().domain([h,i]).range([d-e.top-e.bottom,0]),this.svg=d3.select(a).append("svg").attr("class","rwt-plot").attr("width",c).attr("height",d).append("g").attr("transform","translate("+e.left+","+e.top+")"),this.svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",c-e.left-e.right).attr("height",d-e.top-e.bottom),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.y(0)+")").call(d3.svg.axis().scale(this.x).orient("bottom")),this.svg.append("g").attr("class","y axis").call(d3.svg.axis().scale(this.y).orient("left")),this.line=d3.svg.line().x(function(a,b){return f.x(b)}).y(function(a){return f.y(a)}),this.paths=[],this.arr_data=[]},ROSLIB.RWTPlot.prototype.allocatePath=function(a){return this.svg.append("g").attr("clip-path","url(#clip)").append("path").datum([]).attr("class","line line"+a).attr("d",this.line)},ROSLIB.RWTPlot.prototype.addRawData=function(a){var b=_.isArray(a)?a.length:1;1===b&&(a=[a]),ROSLIB.Time.now(),this.data.push(a);var c=this.data.toArray(),d=_.zip(c);if(this.paths.length<a.length)for(var e=this.paths.length;e<a.length;e++)this.paths.push(this.allocatePath(e%7));for(var f=0;f<d.length;f++){var g=d[f];this.need_to_animate?this.paths[f].datum(g).attr("d",this.line).attr("transform",null).transition().ease("linear").attr("transform","translate("+this.x(-1)+",0)"):this.paths[f].datum(g).attr("d",this.line).attr("transform",null).transition()}this.data.length()===this.max_data&&(this.need_to_animate=!0)},ROSLIB.ROSTimeToSec=function(a){return a.secs+a.nsecs/1e9},ROSLIB.ROSTimeDifference=function(a,b){return a.secs-b.secs+(a.nsecs-b.nsecs)/1e9},ROSLIB.RWTPlot.prototype.chopTimestampedData=function(a){if(this.data.length>0){for(var b=0,c=0;c<this.data.length;c++){var d=ROSLIB.ROSTimeDifference(a,this.data[c].stamp);if(!(d>this.max_data))break;b+=1}this.data=this.data.slice(b)}},ROSLIB.RWTPlot.prototype.addTimestampedData=function(a,b){this.chopTimestampedData(a,b);var c=_.isArray(b)?b.length:1;1===c&&(b=[b]),b.stamp=a,this.data.push(b);for(var d=[],e=this.data[0].stamp,f=0;f<this.data.length;f++)for(var g=0;g<this.data[f].length;g++){var h=this.data[f][g];if(!a.equal(e)){var i=ROSLIB.ROSTimeDifference(this.data[f].stamp,e),j=[i,h];d.length<=g&&d.push([]),d[g].push(j)}}this.plot&&this.plot.setData(d)},ROSLIB.RWTPlot.prototype.addData=function(a,b){this.use_timestamp?this.addTimestampedData(a,b):this.addRawData(a)},ROSLIB.profile=function(a){var b=ROSLIB.Time.now();a.call();var c=ROSLIB.Time.now(),d=c.substract(b);console.log("profile: "+d.toSec())},ROSLIB.RingBuffer=function(a){this.bufferCount=(a||{}).bufferCount||100,this.clear()},ROSLIB.RingBuffer.prototype.push=function(a){return this.endIndex++,this.endIndex===this.bufferCount&&(this.endIndex=0),this.count>=this.bufferCount?(this.buffer[this.endIndex]=a,this.startIndex++,this.startIndex===this.bufferCount&&(this.startIndex=0)):this.buffer[this.endIndex]=a,this.count++,a},ROSLIB.RingBuffer.prototype.clear=function(){this.buffer=new Array(this.bufferCount),this.startIndex=0,this.endIndex=-1,this.count=0},ROSLIB.RingBuffer.prototype.map=function(a){for(var b=[],c=this.startIndex;c<Math.min(this.count,this.bufferCount);c++)b.push(a.call(this,this.buffer[c]));if(this.count>this.bufferCount)for(var d=0;d<this.endIndex+1;d++)b.push(a.call(this,this.buffer[d]));return b},ROSLIB.RingBuffer.prototype.toArray=function(){return this.map(function(a){return a})},ROSLIB.RingBuffer.prototype.length=function(){return Math.min(this.bufferCount,this.count)},ROSLIB.Ros.prototype.getTopicType=function(a,b){var c=new ROSLIB.Service({ros:this,name:"/rosapi/topic_type",serviceType:"rosapi/TopicType"}),d=new ROSLIB.ServiceRequest({topic:a});c.callService(d,function(a){b(a.type)})},ROSLIB.Ros.prototype.getMessageDetails=function(a,b){var c=new ROSLIB.Service({ros:this,name:"/rosapi/message_details",serviceType:"rosapi/MessageDetails"}),d=new ROSLIB.ServiceRequest({type:a});c.callService(d,function(a){b(a.typedefs)})},ROSLIB.Ros.prototype.decodeTypeDefs=function(a){a[0];var b=function(a,c){for(var d={},e=0;e<a.fieldnames.length;e++){var f=a.fieldarraylen[e],g=a.fieldnames[e],h=a.fieldtypes[e];if(-1===h.indexOf("/"))d[g]=-1===f?h:[h];else{for(var i=!1,j=0;j<c.length;j++)if(c[j].type.toString()===h.toString()){i=c[j];break}if(!i)throw"cannot find "+h;var k=b(i,c);d[g]=-1===f?k:[k]}}return d};return b(a[0],a)},ROSLIB.Time=function(a){this.nsecs=Math.ceil((a||{}).nsecs||0),this.secs=Math.ceil((a||{}).secs||0)},ROSLIB.Time.now=function(){var a=new Date,b=a.getTime();return new ROSLIB.Time({secs:Math.ceil(b/1e3),nsecs:1e6*(b%1e3)})},ROSLIB.Time.prototype.toSec=function(){return this.secs+this.nsecs/1e9},ROSLIB.Time.prototype.toMillSec=function(){return 1e3*this.secs+this.nsecs/1e6},ROSLIB.Time.prototype.substract=function(a){var b=this.secs-a.secs,c=this.nsecs-a.nsecs;return 0>c&&(b-=1,c=1e9+c),new ROSLIB.Time({secs:b,nsecs:c})},ROSLIB.Time.prototype.equal=function(a){var b=this.substract(a);return 0===b.secs&&0===b.nsecs},ROSLIB.Time.fromROSMsg=function(a){return new ROSLIB.Time({secs:a.secs,nsecs:a.nsecs})};