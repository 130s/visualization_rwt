ROSLIB.DiagnosticsDirectory=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=[]),this.parent=b,this.children=c,this.status=a.status,this.name=a.name},ROSLIB.DiagnosticsDirectory.prototype.findDirectory=function(a){if(this.name.toString()===a.toString())return this;if(0===this.children.length)return null;for(var b=0;b<this.children.length;b++){var c=this.children[b].findDirectory(a);if(null!==c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.addChild=function(a){this.children.push(a),a.parent=this},ROSLIB.DiagnosticsDirectory.prototype.createChild=function(a){var b=new ROSLIB.DiagnosticsDirectory({name:a},this);return this.addChild(b),b},ROSLIB.DiagnosticsDirectory.prototype.registerStatus=function(a){return this.status=a,a},ROSLIB.DiagnosticsDirectory.prototype.isChildrenHasError=function(){if(this.isErrorStatus())return this;for(var a=0;a<this.children.length;a++){var b=this.children[a].isChildrenHasError();if(b)return b}},ROSLIB.DiagnosticsDirectory.prototype.isErrorStatus=function(){return this.status?this.status.isERROR():!1},ROSLIB.DiagnosticsDirectory.prototype.fullName=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return c+"/"+b.name};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.getErrorDirectories=function(){var a=function(b){if(0===b.children.length)return b.isErrorStatus()?[b]:[];for(var c=[],d=0;d<b.children.length;d++){var e=a(b.children[d]);c=c.concat(e)}return b.isErrorStatus()&&c.push(b),c};return a(this)},ROSLIB.DiagnosticsHistory=function(a){"undefined"==typeof a&&(a={}),this.root=new ROSLIB.DiagnosticsDirectory({name:"root"})},ROSLIB.DiagnosticsHistory.prototype.registerStatus=function(a){for(var b=this.root,c=0;c<a.path.length;c++){var d=b.findDirectory(a.path[c]);null===d&&(d=b.createChild(a.path[c])),b=d}return b.registerStatus(a),b},ROSLIB.DiagnosticsStatus=function(a){"undefined"==typeof a&&(a={}),this.name=a.name,this.message=a.message,this.level=a.level,this.hardware_id=a.hardware_id,this.values={},this.stamp=a.timestamp;for(var b=0;b<a.values.length;b++)this.values[a.values[b].key]=a.values[b].value;this.path=_.filter(this.name.split("/"),function(a){return a.toString()!=="".toString()})},ROSLIB.DiagnosticsStatus.LEVEL={OK:0,WARN:1,ERROR:2},ROSLIB.DiagnosticsStatus.prototype.isOK=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.OK},ROSLIB.DiagnosticsStatus.prototype.isWARN=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN},ROSLIB.DiagnosticsStatus.prototype.isERROR=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR},ROSLIB.DiagnosticsStatus.createFromArray=function(a){var b=a.header,c=ROSLIB.Time.fromROSMsg(b);return _.map(a.status,function(a){return new ROSLIB.DiagnosticsStatus({timestamp:c,name:a.name,message:a.message,hardware_id:a.hardware_id,level:a.level,values:a.values})})},ROSLIB.RWTRobotMonitor=function(a){var b=a.diagnostics_agg_topic||"/diagnostics_agg",c=a.ros;this.last_diagnostics_update=null,this.last_time_id=a.last_time_id,this.history=new ROSLIB.DiagnosticsHistory(a),this.diagnostics_agg_subscriber=new ROSLIB.Topic({ros:c,name:b,messageType:"diagnostic_msgs/DiagnosticArray"});var d=this;this.diagnostics_agg_subscriber.subscribe(function(a){d.diagnosticsCallback(a)}),setTimeout(function(){d.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.diagnosticsCallback=function(a){this.last_diagnostics_update=ROSLIB.Time.now();var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)}),this.updateView()},ROSLIB.RWTRobotMonitor.prototype.updateLastTimeString=function(){var a=this;if(a.last_diagnostics_update){var b=ROSLIB.Time.now(),c=b.substract(a.last_diagnostics_update).toSec();$(a.last_time_id).html(Math.floor(c))}else $(a.last_time_id).html(-1);setTimeout(function(){a.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.updateView=function(){this.updateErrorList()},ROSLIB.RWTRobotMonitor.prototype.updateErrorList=function(){$("#error-list li").remove();var a=this.history.root.getErrorDirectories();a.sort(function(a,b){var c=a.fullName(),d=b.fullName();return c>d?1:d>c?-1:0}),_.forEach(a,function(a){var b='<li class="list-group-item"><span class="glyphicon glyphicon-minus-sign"></span>',c="</li>";$("#error-list").append(b+a.fullName()+":"+a.status.message+c)})};